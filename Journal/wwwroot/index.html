<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Jornal</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="css/themes.css" />
    <link rel="stylesheet" href="css/auth.css" />
    <link rel="stylesheet" href="Journal.styles.css" />
    <link rel="icon" href="data:," />
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/editor.js"></script>
  </head>

  <body>
    <div class="status-bar-safe-area"></div>

    <div id="app">Loading...</div>

    <div id="blazor-error-ui">
      An unhandled error has occurred.
      <a href="" class="reload">Reload</a>
      <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>

    <script>
      window.formatText = function (format) {
        const textarea = document.getElementById("content-editor");
        if (!textarea) return;

        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const text = textarea.value;
        const selectedText = text.substring(start, end);

        let formattedText = "";
        let cursorOffset = 0;

        switch (format) {
          case "bold":
            if (selectedText) {
              formattedText = "**" + selectedText + "**";
              cursorOffset = selectedText.length + 4;
            } else {
              formattedText = "****";
              cursorOffset = 2;
            }
            break;
          case "italic":
            if (selectedText) {
              formattedText = "*" + selectedText + "*";
              cursorOffset = selectedText.length + 2;
            } else {
              formattedText = "**";
              cursorOffset = 1;
            }
            break;
          case "underline":
            if (selectedText) {
              formattedText = "__" + selectedText + "__";
              cursorOffset = selectedText.length + 4;
            } else {
              formattedText = "____";
              cursorOffset = 2;
            }
            break;
          case "heading":
            formattedText = "# " + (selectedText || "");
            cursorOffset = selectedText ? selectedText.length + 2 : 2;
            break;
          case "list":
            formattedText = "- " + (selectedText || "");
            cursorOffset = selectedText ? selectedText.length + 2 : 2;
            break;
          case "link":
            if (selectedText) {
              formattedText = "[" + selectedText + "](url)";
              cursorOffset = selectedText.length + 3;
            } else {
              formattedText = "[]()";
              cursorOffset = 1;
            }
            break;
          case "image":
            if (selectedText) {
              formattedText = "![" + selectedText + "](image-url)";
              cursorOffset = selectedText.length + 4;
            } else {
              formattedText = "![]()";
              cursorOffset = 2;
            }
            break;
          case "quote":
            formattedText = "> " + (selectedText || "");
            cursorOffset = selectedText ? selectedText.length + 2 : 2;
            break;
          case "code":
            if (selectedText) {
              formattedText = "`" + selectedText + "`";
              cursorOffset = selectedText.length + 2;
            } else {
              formattedText = "``";
              cursorOffset = 1;
            }
            break;
        }

        // Replace selected text with formatted text
        const newText =
          text.substring(0, start) + formattedText + text.substring(end);
        textarea.value = newText;

        // Trigger input event to update Blazor binding
        textarea.dispatchEvent(new Event("input", { bubbles: true }));

        // Set cursor position
        setTimeout(() => {
          const newPos = start + cursorOffset;
          textarea.setSelectionRange(newPos, newPos);
          textarea.focus();
        }, 10);
      };

      window.downloadFile = function (fileName, base64Content) {
        const link = document.createElement("a");
        link.download = fileName;
        link.href = "data:application/octet-stream;base64," + base64Content;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };
    </script>
  </body>
</html>
